---
import { Picture } from "astro:assets";
import SliderButton from "./SliderButton.astro";
import RightArrow from "../assets/icons/arrow-right.svg";
import LeftArrow from "../assets/icons/arrow-left.svg";
import type { PortfolioItem } from "../content/portfolio";

const { items } = Astro.props as { items: PortfolioItem[] };

const MIN_LOOP_ITEMS = 6;

const loopItems =
    items.length >= MIN_LOOP_ITEMS
        ? items
        : Array.from(
              { length: Math.ceil(MIN_LOOP_ITEMS / items.length) },
              () => items,
          ).flat();
---

<div data-aos="fade-up" class="relative text-secondary">
    <SliderButton direction="prev" ariaLabel="Previous">
        <LeftArrow class="w-5 h-5 md:w-7 md:h-7" />
    </SliderButton>

    <SliderButton direction="next" ariaLabel="Next">
        <RightArrow class="w-5 h-5 md:w-7 md:h-7" />
    </SliderButton>

    <div class="swiper portfolio-swiper">
        <div class="swiper-wrapper">
            {
                loopItems.map((p) => (
                    <div class="swiper-slide">
                        <div class="slide-inner">
                            <article class="w-full">
                                <div class="relative overflow-hidden rounded-lg group">
                                    <Picture
                                        src={p.image}
                                        alt={p.title}
                                        width={1920}
                                        height={1080}
                                        loading="lazy"
                                        decoding="async"
                                        class="block w-full aspect-video object-cover"
                                    />

                                    <a
                                        href={p.href}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        class="absolute inset-0 z-10 flex items-center justify-center bg-black/0 opacity-0 transition-all duration-300 group-hover:bg-black/50 group-hover:opacity-100 cursor-pointer"
                                        aria-label={`OtwÃ³rz: ${p.title}`}
                                    >
                                        <span class="inline-flex px-6 py-3 rounded-lg border border-secondary/40 text-secondary uppercase tracking-widest text-xs bg-dark/20 translate-y-3 opacity-0 transition-all duration-500 group-hover:translate-y-0 group-hover:opacity-100">
                                            {p.label}
                                        </span>
                                    </a>
                                </div>

                                <div class="pt-5 text-center">
                                    <p class="text-xs tracking-[0.25em] text-white/50 uppercase">
                                        {p.category}
                                    </p>
                                    <h4 class="mt-2 text-xl md:text-2xl font-semibold">
                                        {p.title}
                                    </h4>
                                    <p class="mt-2 text-sm md:text-base text-white/70 max-w-[52ch] mx-auto">
                                        {p.description}
                                    </p>
                                </div>
                            </article>
                        </div>
                    </div>
                ))
            }
        </div>
    </div>
</div>

<style is:global>
    .portfolio-swiper {
        overflow: hidden;
    }
    .portfolio-swiper .swiper-slide {
        width: clamp(600px, 80vw, 1100px);
        transition: opacity 320ms ease;
    }
    .portfolio-swiper .swiper-slide .slide-inner {
        transition: transform 320ms ease;
        transform: scale(0.86);
        transform-origin: center;
    }

    .portfolio-swiper .swiper-slide-active {
        opacity: 1;
    }
    .portfolio-swiper .swiper-slide-active .slide-inner {
        transform: scale(1);
    }

    .portfolio-swiper .swiper-slide-prev,
    .portfolio-swiper .swiper-slide-next {
        opacity: 0.65;
    }
    .portfolio-swiper .swiper-slide-prev .slide-inner,
    .portfolio-swiper .swiper-slide-next .slide-inner {
        transform: scale(0.92);
    }
    @media (max-width: 640px) {
        .portfolio-swiper .swiper-slide {
            width: clamp(280px, 86vw, 520px);
        }
    }
</style>

<script>
    import "../scripts/swiper.ts";
</script>
