---
import Logo from "../assets/icons/Codify-logo-ciemne.svg";
import Button from "./Button.astro";
import BurgerButton from "./BurgerButton.astro";
import type { NavData } from "../content/menuItems";
import { resolveHref } from "../lib/resolveHref";
import { SERVICES } from "../content/services";

const { nav } = Astro.props as { nav: NavData };

const homeHref = resolveHref(nav.homeHref ?? "#home");

// bierzemy submenu z nav (pierwszy item z children)
const servicesItem = nav.menu.find((i) => i.children?.length);
---

<div
    id="main-menu"
    class="fixed top-0 left-0 w-full h-15 md:h-22.5 bg-primary lg:bg-black/30 backdrop-blur-0 md:backdrop-blur-xl z-50 flex text-center"
>
    <div
        class="w-full max-w-360 mx-auto px-5 flex items-center justify-between gap-5"
    >
        <a
            href={homeHref}
            class="flex flex-col gap-1.5 items-center group text-secondary md:text-secondary hover:text-accent transform hover:rotate-44 transition-all duration-500 ease-out"
            aria-label="Go to home"
        >
            <Logo
                fill="currentColor"
                class="w-11 h-11 md:w-13 md:h-13 md:group-hover:translate-y-3 md:group-hover:scale-[1.3] transition-all duration-500"
            />
            <p
                class="hidden leading-none md:block md:group-hover:opacity-0 md:group-hover:scale-95 transition-all duration-300"
            >
                CODIFY
            </p>
        </a>

        <div class="hidden lg:flex lg:gap-7 lg:items-center">
            {
                nav.menu.map((item) =>
                    item.children?.length ? (
                        <div class="relative group">
                            <a
                                id="services-trigger"
                                href={resolveHref(item.href)}
                                class="text-secondary md:text-xl font-medium hover:text-accent transition-colors duration-500 ease inline-flex items-center gap-0"
                                aria-haspopup="true"
                                aria-expanded="false"
                            >
                                {item.label}
                                <span class="nav-caret text-secondary group-hover:text-accent transition-colors duration-500 ease inline-block">
                                    â–¾
                                </span>
                            </a>
                        </div>
                    ) : (
                        <a
                            href={resolveHref(item.href)}
                            class="text-secondary md:text-xl font-medium hover:text-accent transition-colors duration-500 ease"
                        >
                            {item.label}
                        </a>
                    ),
                )
            }
        </div>

        {
            nav.cta && (
                <div class="hidden lg:block">
                    <Button
                        text={nav.cta.label}
                        href={resolveHref(nav.cta.href)}
                        variant="outlined"
                    />
                </div>
            )
        }

        <BurgerButton />
    </div>
</div>
{
    servicesItem?.children?.length && (
        <div
            id="services-dropdown"
            class="services-dropdown fixed w-80 bg-primary lg:bg-black/30 backdrop-blur-0 md:backdrop-blur-xl opacity-0 invisible scale-y-0 origin-top transition-all duration-300 z-50"
        >
            <div class="py-2 text-center">
                {servicesItem.children.map((child) => (
                    <a
                        href={resolveHref(child.href)}
                        class={`block text-lg px-4 py-3 text-secondary hover:text-accent transition-colors ${child.mobileOnly ? "lg:hidden" : ""}`}
                    >
                        {child.label}
                    </a>
                ))}
            </div>
        </div>
    )
}
<style>
    .services-dropdown::before {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        top: -31px;
        height: 31px;
        background: transparent;
    }
    #services-trigger .nav-caret {
        transition: transform 300ms ease;
        transform: rotate(0deg);
    }

    #services-trigger[aria-expanded="true"] .nav-caret {
        transform: rotate(180deg);
    }
</style>

<script>
    import "../scripts/servicesDropdown";
</script>
